# ğŸš— SIM Service API

API untuk Sistem Informasi Manajemen dengan fitur CRUD User, KTP (Kartu Tanda Penduduk), dan SIM (Surat Izin Mengemudi). Mendukung autentikasi JWT, pagination, search, dan sorting dengan keamanan CSRF protection.

## ğŸ“‹ Table of Contents

- [Features](#-features)
- [Tech Stack](#-tech-stack)
- [Prerequisites](#-prerequisites)
- [Installation](#-installation)
- [Database Setup](#-database-setup)
- [Environment Variables](#-environment-variables)
- [Running the Application](#-running-the-application)
- [API Documentation](#-api-documentation)
- [Security Features](#-security-features)
- [Database Schema](#-database-schema)
- [API Endpoints](#-api-endpoints)
- [Testing with Postman](#-testing-with-postman)
- [Project Structure](#-project-structure)
- [Contributing](#-contributing)

## âœ¨ Features

- ğŸ” **JWT Authentication** dengan refresh token
- ğŸª **HTTP-only Cookie** untuk refresh token
- ğŸ›¡ï¸ **CSRF Protection** untuk semua endpoint POST/PUT/DELETE
- ğŸ‘¥ **User Management** dengan CRUD operations
- ğŸ†” **SIM Management** dengan validasi lengkap
- ğŸ“„ **Pagination & Search** untuk semua list endpoints
- ğŸ” **Advanced Filtering** dan sorting
- ğŸ“š **Swagger Documentation** yang lengkap
- ğŸ§ª **Postman Collection** untuk testing
- ğŸ—ï¸ **Clean Architecture** dengan separation of concerns

## ğŸ› ï¸ Tech Stack

- **Runtime**: Node.js
- **Framework**: Express.js
- **Language**: TypeScript
- **Database**: MySQL
- **ORM**: Knex.js
- **Authentication**: JWT + HTTP-only cookies
- **Security**: CSRF protection, Helmet, CORS
- **Documentation**: Swagger UI
- **Validation**: Zod
- **Hashing**: bcrypt
- **Logging**: Pino

## ğŸ“‹ Prerequisites

Sebelum menjalankan aplikasi, pastikan Anda telah menginstall:

- [Node.js](https://nodejs.org/) (v18 atau lebih baru)
- [MySQL](https://www.mysql.com/) (v8.0 atau lebih baru)
- [npm](https://www.npmjs.com/) atau [yarn](https://yarnpkg.com/)

## ğŸš€ Installation

1. **Clone repository**
   ```bash
   git clone <repository-url>
   cd service-sim
   ```

2. **Install dependencies**
   ```bash
   npm install
   ```

3. **Build TypeScript**
   ```bash
   npm run build
   ```

## ğŸ—„ï¸ Database Setup

1. **Buat database MySQL**
   ```sql
   CREATE DATABASE sim_service_dev;
   ```

2. **Jalankan migrations**
   ```bash
   npm run migrate:latest
   ```

3. **Jalankan seeders (opsional)**
   ```bash
   npm run seed:run
   ```

## âš™ï¸ Environment Variables

Buat file `.env` di root directory dengan konfigurasi berikut:

```env
# Server Configuration
PORT=8026
NODE_ENV=development

# Database Configuration
DB_HOST=localhost
DB_PORT=3306
DB_NAME=sim_service
DB_USER=your_username
DB_PASSWORD=your_password

# JWT Configuration
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
JWT_REFRESH_SECRET=your-super-secret-refresh-key-change-this-in-production
JWT_EXPIRES_IN=15m
JWT_REFRESH_EXPIRES_IN=7d

# CSRF Configuration
CSRF_SECRET=your-csrf-secret-key-change-this-in-production

# CORS Configuration
FRONTEND_URL=http://localhost:5173
```

## ğŸƒâ€â™‚ï¸ Running the Application

### Development Mode
```bash
npm run dev
```

### Production Mode
```bash
npm run build
npm start
```

Aplikasi akan berjalan di `http://localhost:8026`

## ğŸ“š API Documentation

### Swagger UI
Setelah aplikasi berjalan, akses dokumentasi API di:
```
http://localhost:8026/api-docs
```

### Postman Collection
Import file `docs/sim.postman_collection.json` ke Postman untuk testing yang mudah.

## ğŸ”’ Security Features

### 1. JWT Authentication
- Access token dengan expiry 15 menit
- Refresh token dengan expiry 7 hari
- HTTP-only cookie untuk refresh token

### 2. CSRF Protection
- Double CSRF protection menggunakan `csrf-csrf` library
- Token otomatis disimpan di HTTP-only cookie
- Header `X-CSRF-Token` diperlukan untuk POST/PUT/DELETE

### 3. Password Security
- Bcrypt hashing dengan salt rounds
- Password minimum 8 karakter

### 4. CORS Configuration
- Whitelist origin untuk frontend
- Credentials support untuk cookie

### 5. Rate Limiting
- Express rate limiting untuk mencegah abuse

## ğŸ§ª Testing with Postman

1. **Import Collection**
   - Buka Postman
   - Import file `docs/sim.postman_collection.json`

2. **Setup Environment**
   - Set `baseUrl` variable ke `http://localhost:8026`

3. **Testing Flow**
   ```
   1. Get CSRF Token
   2. Login (akan set refresh token cookie)
   3. Test protected endpoints
   4. Refresh token (menggunakan cookie)
   5. Logout
   ```

## ğŸ“ Project Structure

```
service-sim/
â”œâ”€â”€ docs/                          # Documentation
â”‚   â”œâ”€â”€ swagger.json              # Swagger API documentation
â”‚   â”œâ”€â”€ sim.postman_collection.json # Postman collection
â”‚   â””â”€â”€ erdSim.puml               # Database ERD
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app.ts                    # Express app configuration
â”‚   â”œâ”€â”€ index.ts                  # Application entry point
â”‚   â”œâ”€â”€ configs/                  # Configuration files
â”‚   â”œâ”€â”€ controllers/              # Request handlers
â”‚   â”œâ”€â”€ middlewares/              # Custom middlewares
â”‚   â”œâ”€â”€ migrations/               # Database migrations
â”‚   â”œâ”€â”€ models/                   # Data models
â”‚   â”œâ”€â”€ repositories/             # Data access layer
â”‚   â”œâ”€â”€ routes/                   # Route definitions
â”‚   â”œâ”€â”€ seeds/                    # Database seeders
â”‚   â”œâ”€â”€ services/                 # Business logic
â”‚   â”œâ”€â”€ types/                    # TypeScript type definitions
â”‚   â”œâ”€â”€ utils/                    # Utility functions
â”‚   â””â”€â”€ validations/              # Input validation schemas
â”œâ”€â”€ package.json                  # Dependencies and scripts
â”œâ”€â”€ tsconfig.json                 # TypeScript configuration
â”œâ”€â”€ knexfile.ts                   # Knex database configuration
â””â”€â”€ README.MD                     # This file
```
